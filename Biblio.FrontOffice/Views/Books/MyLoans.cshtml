@model List<Biblio.FrontOffice.Data.UserLoanRow>
@{
  ViewData["Title"] = "Mes emprunts";
  var now = DateTime.UtcNow;
}

<div class="fo-hero mb-3">
  <h1>Mes emprunts</h1>
  <p>See your active loans and return them.</p>
</div>

@if (Model.Count == 0)
{
  <div class="alert alert-secondary">No loans yet.</div>
}
else
{
  <div class="card border-0 shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Title</th>
            <th>Start</th>
            <th>Due</th>
            <th>Status</th>
            <th class="text-end">Action</th>
          </tr>
        </thead>
        <tbody>
        @foreach (var l in Model)
        {
          bool returned = l.ReturnedAt != null;
          bool overdue = !returned && l.DueAt < now;

          <tr>
            <td class="fw-semibold">@l.Title</td>
            <td>@l.StartAt.ToString("yyyy-MM-dd")</td>
            <td>@l.DueAt.ToString("yyyy-MM-dd")</td>
            <td>
              @if (returned)
              {
                <span class="badge text-bg-secondary">Returned</span>
              }
              else if (overdue)
              {
                <span class="badge text-bg-danger">Overdue</span>
              }
              else
              {
                <span class="badge text-bg-success">Active</span>
              }
            </td>
            <td class="text-end">
              @if (!returned)
              {
                <a class="btn btn-sm btn-outline-dark" href="/Books/Read/@l.BookId">Read</a>
                <form method="post" action="/Books/ReturnByBook/@l.BookId" class="d-inline">
                  <button class="btn btn-sm btn-warning" type="submit">Return</button>
                </form>
              }
              else
              {
                <span class="text-muted small">â€”</span>
              }
            </td>
          </tr>
        }
        </tbody>
      </table>
    </div>
  </div>
}

@model List<Biblio.FrontOffice.Data.BookRow>
@{
  ViewData["Title"] = "Catalogue";
  int page = (int)(ViewBag.Page ?? 1);
  int pages = (int)(ViewBag.Pages ?? 1);
  int pageSize = (int)(ViewBag.PageSize ?? 10);
  string q = (string)(ViewBag.Q ?? "");
  bool onlyAvail = (bool)(ViewBag.OnlyAvailable ?? false);
  var email = ViewBag.Email as string;
}

<div class="fo-hero mb-3">
  <h1>Catalogue</h1>
  <p>Browse, search, borrow, read.</p>
</div>

<form method="get" class="row g-2 align-items-end mb-3">
  <div class="col-12 col-md-6">
    <label class="form-label">Search</label>
    <input class="form-control" name="q" value="@q" placeholder="Title or author..." />
  </div>
  <div class="col-6 col-md-2">
    <label class="form-label">Page size</label>
    <select class="form-select" name="pageSize">
      @foreach (var s in new[] { 5, 10, 20, 50 })
      {
        <option value="@s" selected="@(s==pageSize)">@s</option>
      }
    </select>
  </div>
  <div class="col-6 col-md-2">
    <div class="form-check mt-4">
      <input class="form-check-input" type="checkbox" id="onlyAvailable" name="onlyAvailable" value="true" @(onlyAvail ? "checked" : "") />
      <label class="form-check-label" for="onlyAvailable">Only available</label>
    </div>
  </div>
  <div class="col-12 col-md-2">
    <button class="btn btn-primary w-100" type="submit">Apply</button>
  </div>
</form>

<div class="card border-0 shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Title</th>
          <th>Author</th>
          <th>Category</th>
          <th>Seats</th>
          <th>Status</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
      @foreach (var b in Model)
      {
        <tr>
          <td class="fw-semibold">@b.Title</td>
          <td>@b.Author</td>
          <td><span class="badge text-bg-secondary">@b.Category</span></td>
          <td>@b.ActiveLoans / @b.Seats</td>
          <td>
            @if (b.Available)
            {
              <span class="badge text-bg-success">Available</span>
            }
            else
            {
              <span class="badge text-bg-danger">Full</span>
            }
          </td>
          <td class="text-end">
            <form method="post" action="/Books/Borrow/@b.Id" class="d-inline">
              <button class="btn btn-sm btn-primary" type="submit" @(b.Available ? "" : "disabled")>Borrow</button>
            </form>

            @if (!string.IsNullOrWhiteSpace(email))
            {
              <a class="btn btn-sm btn-outline-dark" href="/Books/Read/@b.Id">Read</a>
            }
          </td>
        </tr>
      }
      </tbody>
    </table>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mt-3">
  <div class="text-muted small">Page @(page) / @(pages)</div>
  <div class="d-flex gap-2">
    @if (page > 1)
    {
      <a class="btn btn-sm btn-outline-secondary" href="?page=@(page-1)&pageSize=@pageSize&q=@q&onlyAvailable=@onlyAvail">Prev</a>
    }
    @if (page < pages)
    {
      <a class="btn btn-sm btn-outline-secondary" href="?page=@(page+1)&pageSize=@pageSize&q=@q&onlyAvailable=@onlyAvail">Next</a>
    }
  </div>
</div>

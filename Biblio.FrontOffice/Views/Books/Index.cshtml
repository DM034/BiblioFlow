@model List<Biblio.FrontOffice.Data.BookRow>
@{
    int page = ViewBag.Page ?? 1;
    int pageSize = ViewBag.PageSize ?? 10;
    int total = ViewBag.Total ?? 0;
    string? q = ViewBag.Q as string;
    int pages = (int)Math.Ceiling(total / (double)pageSize);
    string? email = ViewBag.Email as string;
    string? msg = ViewBag.Msg as string;
}

<h2>BiblioFlow â€” Catalogue</h2>

@if (!string.IsNullOrWhiteSpace(msg))
{
    <p><b>@msg</b></p>
}

@if (string.IsNullOrWhiteSpace(email))
{
    <p><a href="/Account/Login">Login</a></p>
}
else
{
    <form method="post" action="/Account/Logout">
      Logged as: <b>@email</b>
      <button type="submit">Logout</button>
    </form>
}
@if (!string.IsNullOrWhiteSpace(email))
{
  <p><a href="/Loans">My Loans</a></p>
}

<form method="get">
  <input name="q" value="@q" placeholder="Search title/author" />
  <button type="submit">Search</button>
</form>

<table class="table">
  <thead><tr><th>Title</th><th>Author</th><th>Category</th><th></th></tr></thead>
  <tbody>
  @foreach (var b in Model)
  {
    <tr>
      <td>@b.Title</td>
      <td>@b.Author</td>
      <td>@b.Category</td>
      <td>
        <form method="post" action="/Books/Borrow/@b.Id" style="display:inline">
          <button type="submit">Borrow</button>
        </form>
        <a href="/Books/Read/@b.Id" target="_blank">Read</a>
      </td>
    </tr>
  }
  </tbody>
</table>

<div>
   Page @(page) / @(pages)
  @if (page > 1) { <a href="?page=@(page-1)&pageSize=@pageSize&q=@q">Prev</a> }
  @if (page < pages) { <a href="?page=@(page+1)&pageSize=@pageSize&q=@q">Next</a> }
</div>

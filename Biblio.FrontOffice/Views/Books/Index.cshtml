@model List<Biblio.FrontOffice.Data.BookRow>
@{
  ViewData["Title"] = "Catalogue";
  var page = (int)(ViewBag.Page ?? 1);
  var pageSize = (int)(ViewBag.PageSize ?? 10);
  var total = (int)(ViewBag.Total ?? 0);
  var q = (string)(ViewBag.Q ?? "");
  var pages = (int)Math.Ceiling(total / (double)pageSize);
  if (pages < 1) { pages = 1; }
}

<div class="fo-hero mt-3">
  <h1>@ViewData["Title"]</h1>
  <p>Browse, search, borrow, read.</p>

  <form class="row g-2 mt-2" method="get" action="/Books">
    <div class="col-12 col-md-8">
      <input class="form-control" name="q" value="@q" placeholder="Search title or author..." />
    </div>
    <div class="col-6 col-md-2">
      <select class="form-select" name="pageSize">
        <option value="5" selected="@(pageSize==5)">5</option>
        <option value="10" selected="@(pageSize==10)">10</option>
        <option value="20" selected="@(pageSize==20)">20</option>
        <option value="50" selected="@(pageSize==50)">50</option>
      </select>
    </div>
    <div class="col-6 col-md-2 d-grid">
      <button class="btn btn-primary" type="submit">Search</button>
    </div>
  </form>
</div>

<div class="d-flex align-items-center justify-content-between mt-3">
  <div class="small text-muted">
    Total: <strong>@total</strong>
  </div>
  <div class="small">
    Page <strong>@(page)</strong> / <strong>@pages</strong>
  </div>
</div>

@if (Model.Count == 0)
{
  <div class="alert alert-warning mt-3">No books found.</div>
}
else
{
  <div class="row g-3 mt-1">
    @foreach (var b in Model)
    {
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card fo-card h-100">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start gap-2">
              <div>
                <div class="fo-title">@b.Title</div>
                <div class="fo-sub">@b.Author</div>
              </div>
              <span class="badge text-bg-dark">@b.Category</span>
            </div>

            @if (b.Year != null)
            {
              <div class="small text-muted mt-1">Year: @b.Year</div>
            }

            <p class="fo-summary mt-2 mb-3">
              @(string.IsNullOrWhiteSpace(b.Summary) ? "â€”" : b.Summary)
            </p>

            <div class="mt-auto d-flex gap-2">
              <form method="post" action="/Books/Borrow/@b.Id">
                <button class="btn btn-outline-primary btn-sm" type="submit">Borrow</button>
              </form>

              <a class="btn btn-primary btn-sm" href="/Books/Read/@b.Id" target="_blank">Read</a>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  <div class="d-flex align-items-center justify-content-between mt-4">
    <div class="small text-muted">
      Showing @Model.Count items
    </div>

    <div class="d-flex gap-2">
      @if (page > 1)
      {
        <a class="btn btn-outline-light btn-sm"
           href="?page=@(page-1)&pageSize=@pageSize&q=@q">Prev</a>
      }
      @if (page < pages)
      {
        <a class="btn btn-outline-light btn-sm"
           href="?page=@(page+1)&pageSize=@pageSize&q=@q">Next</a>
      }
    </div>
  </div>
}

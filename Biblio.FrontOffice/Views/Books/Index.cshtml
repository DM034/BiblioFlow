@model List<Biblio.FrontOffice.Data.BookRow>
@{
    ViewData["Title"] = "Catalogue";

    int page = ViewBag.Page ?? 1;
    int pages = ViewBag.Pages ?? 1;
    int pageSize = ViewBag.PageSize ?? 10;
    string q = ViewBag.Q ?? "";
    string? email = ViewBag.Email as string;
    string? msg = ViewBag.Msg as string;
}

@if (!string.IsNullOrWhiteSpace(msg))
{
  <div class="alert alert-info border-0" style="background:rgba(59,130,246,.14); color:#dbeafe">
    @msg
  </div>
}

<div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
  <div>
    <h2 class="mb-1 fw-semibold">Catalogue</h2>
    <div class="muted">Browse, search, borrow, read.</div>
  </div>

  <form class="d-flex gap-2" method="get" asp-controller="Books" asp-action="Index">
    <input class="form-control" style="min-width:280px" name="q" value="@q" placeholder="Search by title or author..." />
    <input type="hidden" name="pageSize" value="@pageSize" />
    <button class="btn btn-outline-light" type="submit">Search</button>
  </form>
</div>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th style="width:38%">Title</th>
            <th style="width:22%">Author</th>
            <th style="width:18%">Category</th>
            <th style="width:8%">Year</th>
            <th style="width:14%" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          @foreach (var b in Model)
          {
            <tr>
              <td class="fw-semibold">@b.Title</td>
              <td>@b.Author</td>
              <td><span class="badge bg-secondary">@b.Category</span></td>
              <td>@(b.Year?.ToString() ?? "â€”")</td>
              <td class="text-end">
                <div class="d-inline-flex gap-2">
                  <form method="post" asp-controller="Books" asp-action="Borrow" asp-route-id="@b.Id">
                    <button class="btn btn-sm btn-primary" type="submit">Borrow</button>
                  </form>
                  <a class="btn btn-sm btn-outline-light" asp-controller="Books" asp-action="Read" asp-route-id="@b.Id">Read</a>
                </div>
              </td>
            </tr>
          }

          @if (!Model.Any())
          {
            <tr><td colspan="5" class="p-4 muted">No books found.</td></tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <div class="card-footer d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div class="muted">Page <b>@(page)</b> / <b>@pages</b></div>

    <div class="d-flex gap-2">
      @if (page > 1)
      {
        <a class="btn btn-sm btn-outline-light"
           href="?page=@(page-1)&pageSize=@pageSize&q=@q">Prev</a>
      }
      @if (page < pages)
      {
        <a class="btn btn-sm btn-outline-light"
           href="?page=@(page+1)&pageSize=@pageSize&q=@q">Next</a>
      }
    </div>
  </div>
</div>

@if (string.IsNullOrWhiteSpace(email))
{
  <div class="mt-3 muted">
    You are not logged in. <a asp-controller="Account" asp-action="Login">Login</a> to borrow/read.
  </div>
}
